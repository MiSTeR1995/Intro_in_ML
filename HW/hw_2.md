# Домашнее задание: Метрики и функции потерь в регрессии

## 1. Цель работы
Целью задания является реализация и анализ базового цикла решения задачи регрессии на табличных данных.
В процессе выполнения необходимо:
- реализовать процедуру обучения и оценки модели без утечек данных;
- рассчитать и интерпретировать показатели качества **MAE**, **RMSE**, **R²** (при необходимости — **RMSLE**);
- исследовать влияние выбора **функции потерь** на характер и распределение ошибок модели.

---

## 2. Исходные данные
Для выполнения работы следует выбрать **один** из трёх наборов данных, доступных через библиотеку *Hugging Face Datasets*:

| Набор данных | Код загрузки | Целевая переменная | Описание |
|---------------|---------------|--------------------|-----------|
| Auto MPG | "scikit-learn/auto-mpg" | mpg | Прогноз расхода топлива автомобиля |
| Abalone | "mstz/abalone" | Rings | Прогноз возраста морского моллюска |
| Wine Quality | "mnemoraorg/wine-quality-6k4" | quality | Прогноз оценки качества вина |

Пример загрузки:
```python
from datasets import load_dataset
df = load_dataset("scikit-learn/auto-mpg")["train"].to_pandas()
```

---

## 3. Основные этапы выполнения (до 7 баллов)

### 3.1. Подготовка данных
Выполнить разбиение исходного набора на обучающую, валидационную и тестовую части в соотношении **60 / 20 / 20** с фиксированным `random_state`.
Этапы предобработки (масштабирование числовых признаков, кодирование категориальных) реализовать **внутри конвейера (Pipeline)** для исключения утечек данных.

### 3.2. Построение бейзлайн-моделей
Реализовать два константных предсказателя на основе `y_train`:
- предсказание средним значением;
- предсказание медианой.
Для каждого бейзлайна вычислить **MAE**, **RMSE** и **R²**, провести краткий анализ масштаба ошибок.
Отрицательные значения R² допустимы для константных моделей.

### 3.3. Обучение линейной модели
Обучить модель **LinearRegression**.
Рассчитать **MAE**, **RMSE**, **R²** и сравнить результаты с бейзлайнами.
Построить два графика:
1. диаграмма соответствия `ŷ` и `y` с линией `y = x`;
2. график остатков `r = y − ŷ` в зависимости от `ŷ`.
Провести анализ распределения ошибок (линейность, выбросы, гетероскедастичность).

### 3.4. Сравнение функций потерь
Провести обучение моделей с различными функциями потерь:
- **MSE** (квадратичная ошибка);
- **MAE** (абсолютная ошибка, L1).
Для каждой модели рассчитать **MAE**, **RMSE**, **Р²** и выполнить сравнительный анализ.
На основе полученных метрик сформулировать выводы о влиянии функции потерь на точность и устойчивость модели (например, влияние выбросов на результаты).

### 3.5. Финальная оценка
Выбрать модель, показавшую наилучшее качество по выбранной метрике.
Выполнить итоговую проверку на тестовой выборке, рассчитав **MAE**, **RMSE**, **R²** (при необходимости — **RMSLE**).
Сопоставить результаты на обучающей и тестовой выборках и сделать вывод о стабильности модели.

---

## 4. Дополнительные задания (бонус до +2 баллов, максимум 8 баллов за все ДЗ)
Выполнить **одно** из следующих действий:
- Реализовать дополнительную функцию потерь (**Huber**, **Quantile**, **Poisson**, **Tweedie**) и провести сравнительный анализ результатов.
- Повторить эксперимент на другом наборе данных и сравнить метрики.
- Выполнить дополнительный анализ ошибок: построить **Q–Q-график** или визуализировать распределение абсолютных ошибок по диапазонам признаков.

---

## 5. Требования к отчёту
Результаты оформить в виде **Jupyter-ноутбука (`.ipynb`)**, который запускается «с нуля» без утечек данных и с фиксированным `random_state`.
В отчёте должны быть представлены:
- описание выбранного набора данных и этапов подготовки;
- таблица с метриками для бейзлайнов и моделей;
- два графика из раздела 3.3;
- сравнительный анализ функций потерь (раздел 3.4);
- итоговые результаты и комментарии о стабильности модели.

---

## 6. Критерии оценивания (максимум — 8 баллов)

| Этап | Баллы | Содержание |
|------|--------|------------|
| Подготовка данных и отсутствие утечек | 1.0 | Корректное разбиение, использование Pipeline |
| Бейзлайны и интерпретация | 1.0 | Корректные расчёты, анализ ошибок |
| LinearRegression и визуализация | 2.0 | Метрики, графики, анализ остатков |
| Сравнение функций потерь (MSE и MAE) | 2.0 | Корректное сравнение и интерпретация различий |
| Финальная проверка и выводы | 1.0 | Тестирование и анализ устойчивости |
| Бонусное задание | до +2.0 | Любой пункт из раздела 4 |

---

## 7. Примечания
- Тестовая выборка используется исключительно для итоговой проверки и не должна применяться при обучении или подборе параметров.
- Ключевая метрика (MAE или RMSE) должна быть выбрана и обоснована.
- Метрика **RMSLE** и специальные функции потерь могут применяться только при корректных предпосылках (например, неотрицательная целевая переменная).
- Проверяется не только корректность расчётов, но и качество интерпретации результатов.
